
<project name="id-service-install" default="package" basedir=".">
    <description>
        CollectionSpace ID Service Installer Targets
    </description>
  <!-- set global properties for this build -->
    <property file="${basedir}/../../build.properties" />    
    <property name="src" location="src"/>

    <property name="db" value="mysql"/>
    <property name="db.script.dir" location="${basedir}/db/${db}"/>

    <condition property="osfamily-unix">
        <os family="unix" />
    </condition>
    <condition property="osfamily-windows">
        <os family="windows" />
    </condition>

    <target name="install" description="">
        <exec executable="echo">
        		<arg value="Installer: Executing ID Service's &apos;install&apos; target." />
				</exec>
    </target>

    <target name="config" description="" depends="install">
        <exec executable="echo">
        		<arg value="Installer: Executing ID Service's &apos;config&apos; target." />
				</exec>
    </target>

    <target name="predeploy" depends="config">
        <exec executable="echo">
        		<arg value="Installer: Executing ID Service's &apos;predeploy&apos; target for the ID Service." />
				</exec>
				
        <exec executable="echo">
        		<arg value="Installer: Creating necessary database tables for the ID Service." />
				</exec>				
				<!-- Create the tables -->
        <sql driver="com.mysql.jdbc.Driver"
					url="jdbc:mysql://localhost:3306/cspace"
					userid="root"
					password="admin"
					src="${db.script.dir}/create_id_generators_table.sql">
					    <classpath>
					        <pathelement path="${jboss.lib.cspace}/mysql-connector-java-5.1.7-bin.jar"/>
					    </classpath>
        </sql>
        	
        <exec executable="echo">
        		<arg value="Installer: Loading tables for the ID Service." />
				</exec>        	
				
				<!-- Load the tables -->
        <sql driver="com.mysql.jdbc.Driver"
	        url="jdbc:mysql://localhost:3306/cspace"
	        userid="root"
	        password="admin"
	        src="${db.script.dir}/load_id_generators.sql">
	            <classpath>
	                <pathelement path="${jboss.lib.cspace}/mysql-connector-java-5.1.7-bin.jar"/>
	            </classpath>
        </sql>        	
    </target>
    
    <target name="deploy" description="">
        <exec executable="echo">
        		<arg value="Installer: Executing ID Service's &apos;deploy&apos; target." />
				</exec>
    </target>
    
    <target name="postdeploy" description="">
        <exec executable="echo">
        		<arg value="Installer: Executing ID Service's &apos;init&apos; target." />
				</exec>
    </target>
    
</project>
